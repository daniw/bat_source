/*
 * driver_ADS131M04.c
 *
 *  Created on: Jun 14, 2025
 *      Author: ahorat
 */

#include "ads131m04.h"
#include "ads131m04_config.h"

typedef struct{
    uint16_t address;
    uint16_t value;
} config_list_entry;



// Some #if are removed, because they can no be evaluated. Reason is floating point operations in the calculation of the value.

config_list_entry ads131m04_config_list[] = {

#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_MODE != ADS131M04_DEFAULT_VALUE_MODE
    {ADS131M04_REG_MODE, ADS131M04_CONFIG_VALUE_MODE},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_MODE != ADS131M04_DEFAULT_VALUE_MODE
    {ADS131M04_REG_MODE, ADS131M04_CONFIG_VALUE_MODE},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CLOCK != ADS131M04_DEFAULT_VALUE_CLOCK
    {ADS131M04_REG_CLOCK, ADS131M04_CONFIG_VALUE_CLOCK},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_GAIN != ADS131M04_DEFAULT_VALUE_GAIN
    {ADS131M04_REG_GAIN, ADS131M04_CONFIG_VALUE_GAIN},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CFG != ADS131M04_DEFAULT_VALUE_CFG
    {ADS131M04_REG_CFG, ADS131M04_CONFIG_VALUE_CFG},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_THRSHLD_MSB != ADS131M04_DEFAULT_VALUE_THRSHLD_MSB
    {ADS131M04_REG_THRSHLD_MSB, ADS131M04_CONFIG_VALUE_THRSHLD_MSB},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_THRSHLD_LSB != ADS131M04_DEFAULT_VALUE_THRSHLD_LSB
    {ADS131M04_REG_THRSHLD_LSB, ADS131M04_CONFIG_VALUE_THRSHLD_LSB},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CH0_CFG != ADS131M04_DEFAULT_VALUE_CH0_CFG
    {ADS131M04_REG_CH0_CFG, ADS131M04_CONFIG_VALUE_CH0_CFG},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CH0_OCAL_MSB != ADS131M04_DEFAULT_VALUE_CH0_OCAL_MSB
    {ADS131M04_REG_CH0_OCAL_MSB, ADS131M04_CONFIG_VALUE_CH0_OCAL_MSB},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CH0_OCAL_LSB != ADS131M04_DEFAULT_VALUE_CH0_OCAL_LSB
    {ADS131M04_REG_CH0_OCAL_LSB, ADS131M04_CONFIG_VALUE_CH0_OCAL_LSB},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CH0_GCAL_MSB != ADS131M04_DEFAULT_VALUE_CH0_GCAL_MSB
    {ADS131M04_REG_CH0_GCAL_MSB, ADS131M04_CONFIG_VALUE_CH0_GCAL_MSB},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CH0_GCAL_LSB != ADS131M04_DEFAULT_VALUE_CH0_GCAL_LSB
    {ADS131M04_REG_CH0_GCAL_LSB, ADS131M04_CONFIG_VALUE_CH0_GCAL_LSB},
#endif

#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CH1_CFG != ADS131M04_DEFAULT_VALUE_CH1_CFG
    {ADS131M04_REG_CH1_CFG, ADS131M04_CONFIG_VALUE_CH1_CFG},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CH1_OCAL_MSB != ADS131M04_DEFAULT_VALUE_CH1_OCAL_MSB
    {ADS131M04_REG_CH1_OCAL_MSB, ADS131M04_CONFIG_VALUE_CH1_OCAL_MSB},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CH1_OCAL_LSB != ADS131M04_DEFAULT_VALUE_CH1_OCAL_LSB
    {ADS131M04_REG_CH1_OCAL_LSB, ADS131M04_CONFIG_VALUE_CH1_OCAL_LSB},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CH1_GCAL_MSB != ADS131M04_DEFAULT_VALUE_CH1_GCAL_MSB
    {ADS131M04_REG_CH1_GCAL_MSB, ADS131M04_CONFIG_VALUE_CH1_GCAL_MSB},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CH1_GCAL_LSB != ADS131M04_DEFAULT_VALUE_CH1_GCAL_LSB
    {ADS131M04_REG_CH1_GCAL_LSB, ADS131M04_CONFIG_VALUE_CH1_GCAL_LSB},
#endif

#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CH2_CFG != ADS131M04_DEFAULT_VALUE_CH2_CFG
    {ADS131M04_REG_CH2_CFG, ADS131M04_CONFIG_VALUE_CH2_CFG},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CH2_OCAL_MSB != ADS131M04_DEFAULT_VALUE_CH2_OCAL_MSB
    {ADS131M04_REG_CH2_OCAL_MSB, ADS131M04_CONFIG_VALUE_CH2_OCAL_MSB},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CH2_OCAL_LSB != ADS131M04_DEFAULT_VALUE_CH2_OCAL_LSB
    {ADS131M04_REG_CH2_OCAL_LSB, ADS131M04_CONFIG_VALUE_CH2_OCAL_LSB},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CH2_GCAL_MSB != ADS131M04_DEFAULT_VALUE_CH2_GCAL_MSB
    {ADS131M04_REG_CH2_GCAL_MSB, ADS131M04_CONFIG_VALUE_CH2_GCAL_MSB},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CH2_GCAL_LSB != ADS131M04_DEFAULT_VALUE_CH2_GCAL_LSB
    {ADS131M04_REG_CH2_GCAL_LSB, ADS131M04_CONFIG_VALUE_CH2_GCAL_LSB},
#endif

#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CH3_CFG != ADS131M04_DEFAULT_VALUE_CH3_CFG
    {ADS131M04_REG_CH3_CFG, ADS131M04_CONFIG_VALUE_CH3_CFG},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CH3_OCAL_MSB != ADS131M04_DEFAULT_VALUE_CH3_OCAL_MSB
    {ADS131M04_REG_CH3_OCAL_MSB, ADS131M04_CONFIG_VALUE_CH3_OCAL_MSB},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CH3_OCAL_LSB != ADS131M04_DEFAULT_VALUE_CH3_OCAL_LSB
    {ADS131M04_REG_CH3_OCAL_LSB, ADS131M04_CONFIG_VALUE_CH3_OCAL_LSB},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CH3_GCAL_MSB != ADS131M04_DEFAULT_VALUE_CH3_GCAL_MSB
    {ADS131M04_REG_CH3_GCAL_MSB, ADS131M04_CONFIG_VALUE_CH3_GCAL_MSB},
#endif
#if ADS131M04_FORCE_ALL_REGISTERS || ADS131M04_CONFIG_VALUE_CH3_GCAL_LSB != ADS131M04_DEFAULT_VALUE_CH3_GCAL_LSB
    {ADS131M04_REG_CH3_GCAL_LSB, ADS131M04_CONFIG_VALUE_CH3_GCAL_LSB},
#endif
};

void ADS131M04_configureADC(ADS131M04_handle* handle) {

	uint16_t value;
    
    for(uint8_t line = 0; line<sizeof(ads131m04_config_list)/sizeof(config_list_entry); line++)
    {
    	ADS131M04_writeRegister(handle,ads131m04_config_list[line].address, ads131m04_config_list[line].value);
    }
    
    for(uint8_t line = 0; line<sizeof(ads131m04_config_list)/sizeof(config_list_entry); line++)
    {
    	value = ADS131M04_readRegister(handle, ads131m04_config_list[line].address);
    	printf("Write Register %X  Value: %X Read: %X\n", ads131m04_config_list[line].address,  ads131m04_config_list[line].value, value);
    }


}
