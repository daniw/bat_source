/*
 * driver_bq76905_config.h
 *
 *  Created on: Jun 14, 2025
 *      Author: ahorat
 */

#ifndef INC_BQ76905_CONFIG_H_
#define INC_BQ76905_CONFIG_H_

#define BQ76905_I2C_ADDRESS 0x10

// Application Data
#define BQ76905_SHUNT_RESISTANCE_mOHM 5
#define BQ76905_USER_A 0.001007

// Configuration values in SI units
#define BQ76905_UV_THRESHOLD_V      2.5
#define BQ76905_OV_THRESHOLD_V      4.2
#define BQ76905_UV_SHUTDOWN_CELL_V  2.0
#define BQ76905_UV_SHUTDOWN_PACK_V  8.0
#define BQ76905_OC_CHG_THRESHOLD_A  4.5 
#define BQ76905_OC_DSG1_THRESHOLD_A  9 
#define BQ76905_OC_DSG2_THRESHOLD_A  9 
#define BQ76905_SLEEP_CURRENT_A      0.01 
#define BQ76905_WAKE_CURRENT_A       0.1 // Minimum is 100mA, maximum 1 A

// Set to 0 to force write all registers
#define BQ76905_FORCE_ALL_REGISTERS 0

// Conversion macros
#define BQ76905_VOLTAGE_TO_REG(v)   ((uint16_t)((v) * 1000.0))  // Example: 2.5V -> 75
#define BQ76905_OC_TO_REG(i)        ((uint8_t)(((i*BQ76905_SHUNT_RESISTANCE_mOHM))/2))
#define BQ76905_USER_A_TO_REG(i)    ((int16_t)(i/BQ76905_USER_A))
#define BQ76905_WAKE_A_TO_REG(i)    ((uint8_t)(i*BQ76905_SHUNT_RESISTANCE_mOHM/0.5))

#define BQ76905_CONFIG_VALUE_CAL_VOLT_GAIN_1           0x00	// DO NOT CHANGE (use factory calibration)
#define BQ76905_CONFIG_VALUE_CAL_VOLT_GAIN_STACK       0x00 // DO NOT CHANGE (use factory calibration)
#define BQ76905_CONFIG_VALUE_CAL_VOLT_GAIN_DELTA_2     0x00 // DO NOT CHANGE (use factory calibration)
#define BQ76905_CONFIG_VALUE_CAL_VOLT_GAIN_DELTA_3     0x00 // DO NOT CHANGE (use factory calibration)
#define BQ76905_CONFIG_VALUE_CAL_VOLT_GAIN_DELTA_4     0x00 // DO NOT CHANGE (use factory calibration)
#define BQ76905_CONFIG_VALUE_CAL_VOLT_GAIN_DELTA_5     0x00 // DO NOT CHANGE (use factory calibration)
#define BQ76905_CONFIG_VALUE_CAL_CUR_GAIN              48 // 227 --> 30A Range, 1.007mA Resolution
#define BQ76905_CONFIG_VALUE_CAL_CUR_OFFSET            0x00 // 0
#define BQ76905_CONFIG_VALUE_CAL_CC1_GAIN              48 // 227 --> 30A Range, 1.007mA Resolution
#define BQ76905_CONFIG_VALUE_CAL_CC1_OFFSET            0x00 // 0
#define BQ76905_CONFIG_VALUE_CAL_TS_OFFSET             0x00 // 0 Postprocessing done on processor
#define BQ76905_CONFIG_VALUE_CAL_TEMP_INT_GAIN         0x00 // DO NOT CHANGE (use factory calibration)
#define BQ76905_CONFIG_VALUE_CAL_TEMP_INT_OFFSET       0x00 // DO NOT CHANGE (use factory calibration)
#define BQ76905_CONFIG_VALUE_CONFIG_PWR                0xA1 // 1/4 speed voltage measurement (2.93*5*5*4 = 293ms per full run, both modes), SLEEP EN
#define BQ76905_CONFIG_VALUE_CONFIG_REGOUT             0x0E // DEFAULT 3.3V
#define BQ76905_CONFIG_VALUE_CONFIG_I2C_ADDR           0x08 // Address with highest bit 
#define BQ76905_CONFIG_VALUE_CONFIG_I2C                0x3400 // DEFAULT I2C Low detection 2s
#define BQ76905_CONFIG_VALUE_CONFIG_DA                 0x00 // DEFAULT 2.93ms for all measurements (highest resolution)
#define BQ76905_CONFIG_VALUE_CONFIG_VCELL_MODE         0x04 // 4 Cells active
#define BQ76905_CONFIG_VALUE_CONFIG_ALARM_MASK         0xC2 // DEFAULT value:  Safety Status A/B and Undervoltage
#define BQ76905_CONFIG_VALUE_CONFIG_FET_OPTIONS        0x1A // FET EN and Serial FET and CHG FET enabled during sleep
#define BQ76905_CONFIG_VALUE_CONFIG_CHARGE_DET_TIME    0x01 // DEFAULT
#define BQ76905_CONFIG_VALUE_BAL_CONFIG                0x02 // DEFAULT 1ms Delay
#define BQ76905_CONFIG_VALUE_BAL_MIN_TEMP              0x0B // DEFAULT ToDo: Derive Value
#define BQ76905_CONFIG_VALUE_BAL_MAX_TEMP              0x2C // DEFAULT ToDo: Derive Value
#define BQ76905_CONFIG_VALUE_BAL_MAX_INT_TEMP          0x55 // DEFAULT 85Â°C
#define BQ76905_CONFIG_VALUE_PROT_EN_A                 0xF5 // COV, CUV, SCD, OCD1, OCC, REGOUT
#define BQ76905_CONFIG_VALUE_PROT_EN_B                 0x02 // OTINT // ToDo: Enable External OT and UT
#define BQ76905_CONFIG_VALUE_PROT_DSG_FET_A            0xff // DEFAULT Everything enabled (triggers DSG FET, when protection is triggered)
#define BQ76905_CONFIG_VALUE_PROT_CHG_FET_A            0xEF // DEFAULT Everything enabled (triggers CHG FET, when protection is triggered)
#define BQ76905_CONFIG_VALUE_PROT_FET_B                0x06 // DEFAULT VREF and VSS Protection ON
#define BQ76905_CONFIG_VALUE_PROT_BODY_DIODE           0x0400 // DEFAULT 64 userA = 64mA
#define BQ76905_CONFIG_VALUE_PROT_CELL_COWNTIME        0xFF  // Open Wire detection in Normal mode every 255 AD SCAN
#define BQ76905_CONFIG_VALUE_PROT_CELL_OW_SLEEP        0x10  // DEFAULT Open Wire Check during SLEEP disabled
#define BQ76905_CONFIG_VALUE_PROT_WD_TIMEOUT           0x00 // DEFAULT WD Timeout set to 1 sec
#define BQ76905_CONFIG_VALUE_PROT_VCELL_UV_TH          BQ76905_VOLTAGE_TO_REG(BQ76905_UV_THRESHOLD_V*1000) 
#define BQ76905_CONFIG_VALUE_PROT_VCELL_UV_DELAY       0x0A // DEFAULT Protection Delay 10 Intervals
#define BQ76905_CONFIG_VALUE_PROT_VCELL_UV_HYST        0x02 // DEFAULT Hysteresis 100mV
#define BQ76905_CONFIG_VALUE_PROT_VCELL_OV_TH          BQ76905_VOLTAGE_TO_REG(BQ76905_OV_THRESHOLD_V*1000) 
#define BQ76905_CONFIG_VALUE_PROT_VCELL_OV_DELAY       0x0A // DEFAULT Protection Delay 10 Intervals
#define BQ76905_CONFIG_VALUE_PROT_VCELL_OV_HYST        0x02 // DEFAULT Hysteresis 100mV
#define BQ76905_CONFIG_VALUE_PROT_CUR_OC_CHG_TH        BQ76905_OC_TO_REG(BQ76905_OC_CHG_THRESHOLD_A)
#define BQ76905_CONFIG_VALUE_PROT_CUR_OC_CHG_DELAY     0x00 // DEFAULT DELAY 18.605 ms
#define BQ76905_CONFIG_VALUE_PROT_CUR_OC_DSG_1_TH      BQ76905_OC_TO_REG(BQ76905_OC_DSG1_THRESHOLD_A)
#define BQ76905_CONFIG_VALUE_PROT_CUR_OC_DSG_1_DELAY   0x00 // DEFAULT DELAY 2.745 ms
#define BQ76905_CONFIG_VALUE_PROT_CUR_OC_DSG_2_TH      BQ76905_OC_TO_REG(BQ76905_OC_DSG1_THRESHOLD_A)
#define BQ76905_CONFIG_VALUE_PROT_CUR_OC_DSG_2_DELAY   0x00 // DEFAULT DELAY 6.71 ms
#define BQ76905_CONFIG_VALUE_PROT_CUR_SC_DSG_TH        BQ76905_REG_PROT_CUR_SC_DSG_TH_150mV // 30A Short circuit detection
#define BQ76905_CONFIG_VALUE_PROT_CUR_SC_DSG_DELAY     BQ76905_REG_PROT_CUR_SC_DSG_DELAY_15US // DEFAULT 15US
#define BQ76905_CONFIG_VALUE_PROT_CUR_OC_LATCH_LIM     0x00 // DEFAULT Latching disabled
#define BQ76905_CONFIG_VALUE_PROT_CUR_OC_REC_TIME      0x05 // DEFAULT REcovery time 5s
#define BQ76905_CONFIG_VALUE_PROT_TEMP_OT_CHG_TH       0x37 
#define BQ76905_CONFIG_VALUE_PROT_TEMP_OT_CHG_DEL      0x0F // DEFAULT 15 Measurements
#define BQ76905_CONFIG_VALUE_PROT_TEMP_OT_CHG_REC      0x3F
#define BQ76905_CONFIG_VALUE_PROT_TEMP_UT_CHG_TH       0xD5
#define BQ76905_CONFIG_VALUE_PROT_TEMP_UT_CHG_DEL      15 // DEFAULT 15 Measurements
#define BQ76905_CONFIG_VALUE_PROT_TEMP_UT_CHG_REC      0xC1
#define BQ76905_CONFIG_VALUE_PROT_TEMP_OT_DSG_TH       0x30
#define BQ76905_CONFIG_VALUE_PROT_TEMP_OT_DSG_DEL      15 // DEFAULT 15 Measurements
#define BQ76905_CONFIG_VALUE_PROT_TEMP_OT_DSG_REC      0x37
#define BQ76905_CONFIG_VALUE_PROT_TEMP_UT_DSG_TH       0xFC
#define BQ76905_CONFIG_VALUE_PROT_TEMP_UT_DSG_DEL      15 // DEFAULT 15 Measurements
#define BQ76905_CONFIG_VALUE_PROT_TEMP_UT_DSG_REC      0xE9
#define BQ76905_CONFIG_VALUE_PROT_TEMP_OT_INT_TH       105  // DEFAULT 105 degree celsius
#define BQ76905_CONFIG_VALUE_PROT_TEMP_OT_INT_DEL      15 // DEFAULT 15 Measurements
#define BQ76905_CONFIG_VALUE_PROT_TEMP_OT_INT_REC      100
#define BQ76905_CONFIG_VALUE_PWR_SLEEP_CUR             BQ76905_USER_A_TO_REG(BQ76905_SLEEP_CURRENT_A)
#define BQ76905_CONFIG_VALUE_PWR_SLEEP_VOLT_TIME       0x05 // DEFAULT 5s
#define BQ76905_CONFIG_VALUE_PWR_SLEEP_WAKE            BQ76905_WAKE_A_TO_REG(BQ76905_WAKE_CURRENT_A) 
#define BQ76905_CONFIG_VALUE_PWR_SHDN_VCELL            BQ76905_VOLTAGE_TO_REG(BQ76905_UV_SHUTDOWN_CELL_V)
#define BQ76905_CONFIG_VALUE_PWR_SHDN_VSTACK           BQ76905_VOLTAGE_TO_REG(BQ76905_UV_SHUTDOWN_PACK_V)
#define BQ76905_CONFIG_VALUE_PWR_SHDN_TEMP             0x00 // DEFAULT DISABLED
#define BQ76905_CONFIG_VALUE_PWR_SHDN_TIME             0x00 // DEFAULT No auto shutdown
#define BQ76905_CONFIG_VALUE_SECURITY_SETTINGS         0x00 // DEFAULT
#define BQ76905_CONFIG_VALUE_SECURITY_ACCESS_KEY_1     0x0414  // DEFAULT
#define BQ76905_CONFIG_VALUE_SECURITY_ACCESS_KEY_2     0x3672  // DEFAULT

 #endif /* INC_BQ76905_CONFIG_H_ */
